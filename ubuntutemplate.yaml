apiVersion: vmoperator.vmware.com/v1alpha1
kind: VirtualMachine
metadata:
  name: ubuntuvm
  namespace: supvm
  labels:
    app: ubuntuvm
spec:
  imageName: ubu-template
  className: best-effort-xsmall
  powerState: poweredOn
  storageClass: home-mgmt-cl01-optimal-datastore-default-policy-raid5
  networkInterfaces:
  - networkType: nsx-t
  vmMetadata:
    configMapName: ubuntuvm-configmap
    transport: OvfEnv
---
apiVersion: v1
kind: ConfigMap
metadata:
    name: ubuntuvm-configmap
    namespace: supvm
data:
  user-data: |
    I2Nsb3VkLWNvbmZpZwpjcmVhdGVfaG9zdG5hbWVfZmlsZTogdHJ1ZQpmcWRuOiBiZW5ueTEuaG9tZS5hZHMKcHJlZmVyX2ZxZG5fb3Zlcl9ob3N0bmFtZTogdHJ1ZSAgICAgICAgICAKdXNlcnM6CiAtIGRlZmF1bHQKIC0gbmFtZTogYmVuCiAgIHBsYWluX3RleHRfcGFzc3dkOiBTdDRyZzR0ZSEgCiAgIGxvY2tfcGFzc3dkOiBmYWxzZQogICBzdWRvOgogICAgLSBBTEw9KEFMTCkgTk9QQVNTV0Q6QUxMCiAgIGdyb3Vwczogc3VkbwogICBzaGVsbDogL2Jpbi9iYXNoICAgICAgICAgICAgICAgIApwYWNrYWdlX3VwZ3JhZGU6IHRydWUKcGFja2FnZXM6CiAtIGdpdAogLSBuZXQtdG9vbHMKIC0gbnBtCiAtIHRyYWNlcm91dGUKIC0gbmdpbngKIC0gdGNtZHVtcCAgICAgICAgICAgICAgCmJvb3RjbWQ6CiAtIGRhdGUgPiAvZXRjL2JpcnRoX2NlcnRpZmljYXRlCiAtIGdpdCBjbG9uZSBodHRwczovL2dpdGh1Yi5jb20vYmVuZmFpcmNsb3VnaC9TaW1wbGVXZWJzaXRlCiAtIHN1ZG8gY3AgL1NpbXBsZVdlYnNpdGUvaW5kZXguaHRtbCAvdmFyL3d3dy9odG1sLyAgICAgICAgICAgCmZpbmFsX21lc3NhZ2U6ICJTeXN0ZW0gb25saW5lIGFmdGVyICRVUFRJTUUgc2Vjb25kcyIgICAgICAgICAgICAgIAojc2FsdF9taW5pb246CiMgIGNvbmY6CiMgICAgZmlsZV9jbGllbnQ6IGxvY2FsCiMgICAgZmlsZXNlcnZlcl9iYWNrZW5kOiBbZ2l0ZnNdCiMgICAgZ2l0ZnNfcmVtb3RlczogWydodHRwczovL2dpdGh1Yi5jb20vX3VzZXJfL19yZXBvXy5naXQnXQojICAgIG1hc3Rlcjogc2FsdC5leGFtcGxlLmNvbQojICBjb25maWdfZGlyOiAvZXRjL3NhbHQKIyAgZ3JhaW5zOgojICAgIHJvbGU6IFt3ZWJdCiMgIHBrZ19uYW1lOiBzYWx0LW1pbmlvbgojICBwa2lfZGlyOiAvZXRjL3NhbHQvcGtpL21pbmlvbgojICBwcml2YXRlX2tleTogJy0tLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS0tCiMKIyAgICA8a2V5IGRhdGE+CiMKIyAgICAtLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLS0tCiMKIyAgJwojIHB1YmxpY19rZXk6ICctLS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0tLQojCiMgICA8a2V5IGRhdGE+CiMKIyAgIC0tLS0tLUVORCBQVUJMSUMgS0VZLS0tLS0tLQojCiMgICAnCiMgc2VydmljZV9uYW1lOiBzYWx0LW1pbmlvbgo=
  hostname: ubuntuvm
---
apiVersion: vmoperator.vmware.com/v1alpha1
kind: VirtualMachineService
metadata:
  name: ubuntuvm-service
  namespace: supvm
spec:
  selector:
    app: ubuntuvm
  type: LoadBalancer
  ports:
  - name: ssh
    port: 22
    protocol: TCP
    targetPort: 22
  - name: ping
    protocol: ICMP
